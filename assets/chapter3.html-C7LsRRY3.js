import{_ as n}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as l,a as s,b as h,e,d as k,r as t,o as p}from"./app-K29S6iA3.js";const d="/FPGA-course/assets/fifo-B7RCjyhL.png",r="/FPGA-course/assets/addr_gen_sim-OnmdNorg.png",A="/FPGA-course/assets/addr_gen-ZxcZUieJ.png",g="/FPGA-course/assets/addr_gen2-Dpm6EkNK.png",c="/FPGA-course/assets/addr_gen3-DhEgZT2Z.png",y={};function o(F,i){const a=t("Mermaid");return p(),l("div",null,[i[0]||(i[0]=s("h2",{id:"开源硬件综合工具介绍",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#开源硬件综合工具介绍"},[s("span",null,"开源硬件综合工具介绍")])],-1)),i[1]||(i[1]=s("h3",{id:"yosys-verilog逻辑综合引擎",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#yosys-verilog逻辑综合引擎"},[s("span",null,"Yosys：Verilog逻辑综合引擎")])],-1)),h(" [![GitHub Stars](https://img.shields.io/github/stars/YosysHQ/yosys)](https://github.com/YosysHQ/yosys) "),i[2]||(i[2]=s("h4",{id:"核心架构",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#核心架构"},[s("span",null,"核心架构")])],-1)),e(a,{id:"mermaid-10",code:"eJxLL0osyFDwCeJSAALHaKWgEB8FjbDUosyc/HRNpVgFXV07Badopcj84spipViwKiewoHO00rOuhmdz1j+bseDphhaonDNYziVa6fneiS8WrlDQcPLxdNN3dfF0AxrGBQAVRCJ1"}),i[3]||(i[3]=k(`<hr><h4 id="功能特性" tabindex="-1"><a class="header-anchor" href="#功能特性"><span>功能特性</span></a></h4><ul><li><strong>多前端支持</strong>：Verilog-2005, SystemVerilog（部分）</li><li><strong>综合策略</strong>：行为级/逻辑级/门级优化</li><li><strong>插件生态</strong>：20+官方插件（如<code>proc</code>, <code>fsm</code>）</li></ul><hr><h4 id="ubuntu安装" tabindex="-1"><a class="header-anchor" href="#ubuntu安装"><span>Ubuntu安装</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> apt</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> yosys</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">         # 稳定版</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> apt</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> yosys-next</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # 开发版（Ubuntu 22.04+）</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><hr><h3 id="openroad-物理综合工具链" tabindex="-1"><a class="header-anchor" href="#openroad-物理综合工具链"><span>OpenROAD：物理综合工具链</span></a></h3><h4 id="完整rtl2gds流程" tabindex="-1"><a class="header-anchor" href="#完整rtl2gds流程"><span>完整RTL2GDS流程</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">./flow.tcl</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -design</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> aes_cipher</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> \\</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">           -platform</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> nangate45</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> \\</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">           -clock_period</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 2.5</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h4 id="主要阶段" tabindex="-1"><a class="header-anchor" href="#主要阶段"><span>主要阶段</span></a></h4><ol><li><strong>逻辑优化</strong>（Yosys）</li><li><strong>布局规划</strong>（IO布置）</li><li><strong>时钟树综合</strong></li><li><strong>详细布线</strong></li></ol><hr><h3 id="工具链对比矩阵" tabindex="-1"><a class="header-anchor" href="#工具链对比矩阵"><span>工具链对比矩阵</span></a></h3><table><thead><tr><th>特性</th><th>Yosys</th><th>GHDL</th><th>OpenROAD</th></tr></thead><tbody><tr><td>输入语言</td><td>Verilog</td><td>VHDL</td><td>Verilog</td></tr><tr><td>综合层次</td><td>逻辑级</td><td>行为级</td><td>物理级</td></tr><tr><td>布局布线</td><td>✗</td><td>✗</td><td>✓</td></tr><tr><td>工艺库支持</td><td>Liberty</td><td>✗</td><td>LEF/DEF</td></tr><tr><td>可视化调试</td><td>有限</td><td>GTKWave</td><td>GUI</td></tr></tbody></table><hr><h3 id="开发环境配置建议" tabindex="-1"><a class="header-anchor" href="#开发环境配置建议"><span>开发环境配置建议</span></a></h3><div class="language-dockerfile line-numbers-mode" data-highlighter="shiki" data-ext="dockerfile" data-title="dockerfile" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ubuntu:22.04</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">RUN</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> apt-get update &amp;&amp; apt-get install -y \\</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    yosys \\</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    ghdl \\</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    gtkwave \\</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    nextpnr-ice40</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">WORKDIR</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> /project</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h3 id="扩展资源" tabindex="-1"><a class="header-anchor" href="#扩展资源"><span>扩展资源</span></a></h3><ul><li><a href="https://yosyshq.readthedocs.io/en/latest/" target="_blank" rel="noopener noreferrer">Yosys Manual</a></li><li><a href="https://ghdl.github.io/ghdl/" target="_blank" rel="noopener noreferrer">GHDL Documentation</a></li><li><a href="https://theopenroadproject.org/workshops/" target="_blank" rel="noopener noreferrer">OpenROAD Workshop</a></li></ul><hr><h2 id="yosys使用教程" tabindex="-1"><a class="header-anchor" href="#yosys使用教程"><span>Yosys使用教程</span></a></h2><h3 id="yosys-简介" tabindex="-1"><a class="header-anchor" href="#yosys-简介"><span>Yosys 简介</span></a></h3><p>Yosys 最初是 Claire Wolf 的本科毕业论文项目，旨在支持一种粗粒度可重构架构（CGRA）的综合。随后，它扩展为一个更通用的综合研究基础设施。</p><p>现代的 Yosys 完全支持 Verilog-2005 的可综合子集，并被描述为“硬件综合领域的 GCC”。Yosys 是免费且开源的，广泛应用于业余爱好者、商业应用以及学术领域。</p><p>Yosys 及其伴随的开源 EDA 生态系统目前由 <strong>Yosys Headquarters</strong> 维护，许多核心开发者受雇于 YosysHQ GmbH。其商业扩展版本 <strong>Tabby CAD Suite</strong> 包括 Verific 前端，提供行业级的 SystemVerilog 和 VHDL 支持、基于 SVA 的形式验证以及形式化应用程序。</p><hr><h3 id="你可以用-yosys-做什么" tabindex="-1"><a class="header-anchor" href="#你可以用-yosys-做什么"><span>你可以用 Yosys 做什么</span></a></h3><ol><li><p><strong>读取和处理现代 Verilog-2005 代码（大部分）</strong><br> Yosys 支持 Verilog-2005 的可综合子集，能够解析和处理大部分现代 Verilog 代码。</p></li><li><p><strong>对网表（RTL、逻辑、门级）执行各种操作</strong><br> Yosys 提供了丰富的工具和命令，可以对网表进行转换、优化和分析。</p></li><li><p><strong>使用 ABC 进行逻辑优化和门级映射</strong><br> Yosys 集成了 ABC 工具，能够执行逻辑优化和门级映射，生成高效的硬件实现。</p></li></ol><hr><h3 id="yosys-的典型应用" tabindex="-1"><a class="header-anchor" href="#yosys-的典型应用"><span>Yosys 的典型应用</span></a></h3><ol><li><p><strong>最终生产设计的综合</strong><br> Yosys 可以用于生成最终生产设计的综合结果。</p></li><li><p><strong>预生产综合（在投资其他工具之前进行试运行）</strong><br> 在正式使用商业工具之前，Yosys 可以用于试运行和验证设计。</p></li><li><p><strong>将功能齐全的 Verilog 转换为简单的 Verilog</strong><br> Yosys 能够将复杂的 Verilog 设计简化为更易于理解和处理的版本。</p></li><li><p><strong>将 Verilog 转换为其他格式（如 BLIF、BTOR 等）</strong><br> Yosys 支持将 Verilog 设计转换为多种中间格式，便于与其他工具集成。</p></li><li><p><strong>演示综合算法（例如用于教育目的）</strong><br> Yosys 是一个理想的平台，用于展示和教学硬件综合算法。</p></li><li><p><strong>实验新算法的框架</strong><br> Yosys 提供了灵活的框架，支持开发和测试新的综合算法。</p></li><li><p><strong>构建自定义流程的框架（不仅限于综合，还包括形式验证、逆向工程等）</strong><br> Yosys 的模块化设计使其能够用于构建各种自定义流程，涵盖形式验证、逆向工程等领域。</p></li></ol><hr><h3 id="yosys-不能做什么" tabindex="-1"><a class="header-anchor" href="#yosys-不能做什么"><span>Yosys 不能做什么</span></a></h3><ol><li><p><strong>处理高级语言（如 C/C++/SystemC）</strong><br> Yosys 不支持直接从 C/C++/SystemC 等高级语言进行综合。</p></li><li><p><strong>创建物理布局（布局布线）</strong><br> Yosys 不包含物理布局和布线功能。如果需要这些功能，可以结合使用 <strong>nextpnr</strong> 工具。</p></li><li><p><strong>依赖内置语法检查</strong><br> Yosys 的语法检查功能有限，建议使用外部工具（如 <strong>Verilator</strong>）进行更严格的语法检查。</p></li></ol><hr><h3 id="yosys安装" tabindex="-1"><a class="header-anchor" href="#yosys安装"><span>Yosys安装</span></a></h3><p>在WSL系统中，直接利用下面这个命令就可以安装Yosys</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> apt-get</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> yosys</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">		#ubuntu24.04仓库里面是yosys-0.33</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="综合入门" tabindex="-1"><a class="header-anchor" href="#综合入门"><span>综合入门</span></a></h3><p>本页将引导您完成预打包的 iCE40 FPGA 综合脚本 <code>synth_ice40</code> 的使用。我们将通过一个简单的设计逐步讲解每个步骤，查看调用的命令及其对设计的影响。虽然 <code>synth_ice40</code> 是针对 iCE40 平台的，但我们将讨论的大多数操作在大多数 FPGA 综合脚本中都是通用的。因此，无论实际使用的架构是什么，本文档都将为您提供 Yosys 中综合操作的良好基础理解。</p><h3 id="示例设计" tabindex="-1"><a class="header-anchor" href="#示例设计"><span>示例设计</span></a></h3><p>首先，让我们快速看一下我们将要综合的设计：</p><p><strong>代码清单 1</strong><br><code>fifo.v</code></p><div class="language-verilog line-numbers-mode" data-highlighter="shiki" data-ext="verilog" data-title="verilog" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// 地址生成器/计数器</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">module</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> addr_gen</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">#(  </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">parameter</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> MAX_DATA=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">256</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">	localparam</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> AWIDTH = $clog2(MAX_DATA)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) ( </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">input</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> en, clk, rst,</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">	output</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> reg</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [AWIDTH-</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">] addr</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">	initial</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> addr = </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	// 异步复位</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	// 当使能时递增地址</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">	always</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> @(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">posedge</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> clk </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">or</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> posedge</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> rst)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">		if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (rst)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">			addr &lt;= </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">		else</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (en) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">begin</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">			if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ({&#39;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, addr} == MAX_DATA-</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">				addr &lt;= </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">			else</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">				addr &lt;= addr + </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">		end</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">endmodule</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> //addr_gen</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// 定义我们的顶层 fifo 实体</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">module</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> fifo</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">#(  </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">parameter</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> MAX_DATA=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">256</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">	localparam</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> AWIDTH = $clog2(MAX_DATA)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) ( </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">input</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> wen, ren, clk, rst,</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">	input</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">7</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">] wdata,</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">	output</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> reg</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">7</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">] rdata,</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">	output</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> reg</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [AWIDTH:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">] count</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	// fifo 存储</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	// 同步读优先于写</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">	wire</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [AWIDTH-</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">] waddr, raddr;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">	reg</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">7</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">] data [MAX_DATA-</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">];</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">	always</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> @(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">posedge</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> clk) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">begin</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">		if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (wen)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">			data[waddr] &lt;= wdata;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">		rdata &lt;= data[raddr];</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">	end</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> // storage</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	// 用于写和读地址的 addr_gen</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">	addr_gen</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> #(.MAX_DATA(MAX_DATA))</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">	fifo_writer</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">		.en     (wen),</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">		.clk    (clk),</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">		.rst    (rst),</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">		.addr   (waddr)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">	);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">	addr_gen</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> #(.MAX_DATA(MAX_DATA))</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">	fifo_reader</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">		.en     (ren),</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">		.clk    (clk),</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">		.rst    (rst),</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">		.addr   (raddr)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">	);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	// 状态信号</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">	initial</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> count = </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">	always</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> @(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">posedge</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> clk </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">or</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> posedge</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> rst) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">begin</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">		if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (rst)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">			count &lt;= </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">		else</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (wen &amp;&amp; !ren)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">			count &lt;= count + </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">		else</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (ren &amp;&amp; !wen)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">			count &lt;= count - </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">	end</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">endmodule</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h3 id="_1-模块-addr-gen-地址生成器-计数器" tabindex="-1"><a class="header-anchor" href="#_1-模块-addr-gen-地址生成器-计数器"><span><strong>1. 模块 <code>addr_gen</code>（地址生成器/计数器）</strong></span></a></h3><h4 id="功能概述" tabindex="-1"><a class="header-anchor" href="#功能概述"><span><strong>功能概述</strong></span></a></h4><p>这是一个循环地址生成器，用于生成递增的地址信号。当使能信号 <code>en</code> 有效且未达到最大地址时，地址递增；到达最大值后自动归零。支持异步复位。</p><h4 id="关键代码分析" tabindex="-1"><a class="header-anchor" href="#关键代码分析"><span><strong>关键代码分析</strong></span></a></h4><ul><li><p><strong>参数定义</strong></p><div class="language-verilog line-numbers-mode" data-highlighter="shiki" data-ext="verilog" data-title="verilog" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">parameter</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> MAX_DATA = </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">256</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;        </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// 最大地址范围（默认256）</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">localparam</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> AWIDTH = $clog2(MAX_DATA); </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// 地址位宽（自动计算，如256对应8位）</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>MAX_DATA</code> 定义地址范围（0 到 <code>MAX_DATA-1</code>）。</li><li><code>$clog2</code> 是 SystemVerilog 函数，计算地址位宽。例如，<code>MAX_DATA=256</code> 时，<code>AWIDTH=8</code>。</li></ul></li><li><p><strong>地址更新逻辑</strong></p><div class="language-verilog line-numbers-mode" data-highlighter="shiki" data-ext="verilog" data-title="verilog" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">always</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> @(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">posedge</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> clk </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">or</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> posedge</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> rst) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">begin</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (rst) </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    addr &lt;= </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;                 </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// 异步复位，地址归零</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  else</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (en) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">begin</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ({&#39;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, addr} == MAX_DATA-</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      addr &lt;= </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;               </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// 到达最大地址时归零</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    else</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      addr &lt;= addr + </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;        </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// 正常递增</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  end</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">end</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>异步复位</strong>：<code>rst</code> 信号优先于时钟，直接清零地址。</li><li><strong>地址递增</strong>：在 <code>en</code> 有效时递增地址。</li><li><strong>循环逻辑</strong>：<code>{&#39;0, addr}</code> 将 <code>addr</code> 扩展为足够宽的整数，确保比较正确。当地址达到 <code>MAX_DATA-1</code> 时归零。</li></ul></li></ul><h4 id="潜在问题" tabindex="-1"><a class="header-anchor" href="#潜在问题"><span><strong>潜在问题</strong></span></a></h4><ul><li>若 <code>MAX_DATA</code> 不是 2 的幂（如 200），<code>AWIDTH</code> 会向上取整（如 8 位），此时实际地址范围是 0-255，但 <code>MAX_DATA-1=199</code>，导致 200-255 的地址无法被使用，可能浪费存储空间。需确保 <code>MAX_DATA</code> 是 2 的幂。</li></ul><hr><h3 id="_2-模块-fifo-同步-fifo" tabindex="-1"><a class="header-anchor" href="#_2-模块-fifo-同步-fifo"><span><strong>2. 模块 <code>fifo</code>（同步 FIFO）</strong></span></a></h3><h4 id="功能概述-1" tabindex="-1"><a class="header-anchor" href="#功能概述-1"><span><strong>功能概述</strong></span></a></h4><p>实现一个同步 FIFO（First-In-First-Out）队列，支持同时读写，读优先于写。通过两个 <code>addr_gen</code> 实例分别管理读写地址，并维护数据计数器 <code>count</code>。</p><h4 id="关键代码分析-1" tabindex="-1"><a class="header-anchor" href="#关键代码分析-1"><span><strong>关键代码分析</strong></span></a></h4><ul><li><p><strong>存储结构</strong></p><div class="language-verilog line-numbers-mode" data-highlighter="shiki" data-ext="verilog" data-title="verilog" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">reg</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">7</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">] data [MAX_DATA-</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">]; </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// 存储器，深度 MAX_DATA，位宽 8</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">always</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> @(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">posedge</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> clk) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">begin</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (wen)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    data[waddr] &lt;= wdata;      </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// 写操作</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  rdata &lt;= data[raddr];        </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// 读操作（同步读）</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">end</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>写操作</strong>：在 <code>wen</code> 有效时，将 <code>wdata</code> 写入 <code>waddr</code> 地址。</li><li><strong>读操作</strong>：每个周期更新 <code>rdata</code> 为 <code>raddr</code> 地址的值（同步读）。</li></ul></li><li><p><strong>地址生成器实例化</strong></p><div class="language-verilog line-numbers-mode" data-highlighter="shiki" data-ext="verilog" data-title="verilog" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">addr_gen #(.MAX_DATA(MAX_DATA)) fifo_writer (.en(wen), ...); </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// 写地址生成</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">addr_gen #(.MAX_DATA(MAX_DATA)) fifo_reader (.en(ren), ...); </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// 读地址生成</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>写地址 <code>waddr</code> 在 <code>wen</code> 有效时递增。</li><li>读地址 <code>raddr</code> 在 <code>ren</code> 有效时递增。</li></ul></li><li><p><strong>计数器 <code>count</code> 逻辑</strong></p><div class="language-verilog line-numbers-mode" data-highlighter="shiki" data-ext="verilog" data-title="verilog" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">always</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> @(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">posedge</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> clk </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">or</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> posedge</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> rst) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">begin</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (rst)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    count &lt;= </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;                     </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// 复位清零</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  else</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (wen &amp;&amp; !ren)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    count &lt;= count + </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;             </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// 只写不读，计数加1</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  else</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (ren &amp;&amp; !wen)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    count &lt;= count - </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;             </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// 只读不写，计数减1</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">end</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>count</code> 表示 FIFO 中当前数据数量，位宽为 <code>AWIDTH+1</code>（例如 MAX_DATA=256 时，<code>count</code> 是 9 位，范围 0-256）。</li><li>同时读写时 <code>count</code> 不变。</li></ul></li></ul><h4 id="同步读写特性" tabindex="-1"><a class="header-anchor" href="#同步读写特性"><span><strong>同步读写特性</strong></span></a></h4><ul><li><strong>读优先于写</strong>：在同一个时钟周期内，写入的数据在下一周期才能被读取，确保当前周期读取的是旧数据。</li><li><strong>无空满保护</strong>：代码未检查 <code>count</code> 的边界（如 <code>count == 0</code> 时禁止读，<code>count == MAX_DATA</code> 时禁止写），需外部逻辑处理。</li></ul><h4 id="潜在问题-1" tabindex="-1"><a class="header-anchor" href="#潜在问题-1"><span><strong>潜在问题</strong></span></a></h4><ul><li><strong>溢出/下溢风险</strong>：若在 FIFO 已满时继续写入（或为空时继续读取），会导致数据覆盖或无效读取。需添加 <code>full</code> 和 <code>empty</code> 信号。</li></ul><hr><h3 id="整体设计总结" tabindex="-1"><a class="header-anchor" href="#整体设计总结"><span><strong>整体设计总结</strong></span></a></h3><ul><li><strong>地址生成器</strong>：循环生成读写地址，支持异步复位。</li><li><strong>FIFO 存储</strong>：同步读写，读操作优先。</li><li><strong>计数器逻辑</strong>：跟踪 FIFO 中数据数量，但缺少空满保护。</li><li><strong>扩展性建议</strong>： <ul><li>添加 <code>full</code> 和 <code>empty</code> 信号：<code>full = (count == MAX_DATA)</code>，<code>empty = (count == 0)</code>。</li><li>若需支持非 2 的幂次 <code>MAX_DATA</code>，需修改地址生成器的循环条件。</li></ul></li></ul><p>通过这段代码，可以学习到同步 FIFO 的基本实现方法，包括地址管理、数据存储和状态跟踪。</p><hr><h3 id="_1-测试平台结构" tabindex="-1"><a class="header-anchor" href="#_1-测试平台结构"><span><strong>1. 测试平台结构</strong></span></a></h3><p><strong>代码清单 2</strong><br><code>fifo_tb.v</code></p><div class="language-verilog line-numbers-mode" data-highlighter="shiki" data-ext="verilog" data-title="verilog" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">module</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> fifo_tb</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // 测试参数设置</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    parameter</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> MAX_DATA = </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">4</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;       </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// 使用较小深度便于测试</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    localparam</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> AWIDTH = $clog2(MAX_DATA);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // 输入信号</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    reg</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> clk, rst;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    reg</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> wen, ren;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    reg</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">7</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">] wdata;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // 输出信号</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    wire</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">7</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">] rdata;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    wire</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [AWIDTH:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">] count;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // 实例化被测FIFO</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    fifo</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> #(.MAX_DATA(MAX_DATA)) </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">dut</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        .clk(clk),</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        .rst(rst),</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        .wen(wen),</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        .ren(ren),</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        .wdata(wdata),</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        .rdata(rdata),</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        .count(count)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    );</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // 生成时钟（周期10ns）</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    initial</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> clk = </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    always</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> #5</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> clk = ~clk;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // 主测试流程</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    initial</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> begin</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // 初始化信号</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        wen = </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        ren = </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        wdata = </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        rst = </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        </span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // 复位操作（15ns后释放）</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">        #15</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> rst = </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        </span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // 测试用例1：基本写操作</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">        $display</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\n</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">=== Test 1: Basic write ===&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        wen = </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        repeat</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(MAX_DATA) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">begin</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            wdata = </span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">$random</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            @(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">posedge</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> clk);</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">            #1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">            $display</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Write: 0x%h | Count: %0d&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, wdata, count);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        end</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        wen = </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        </span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // 验证计数</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(count !== MAX_DATA)</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">            $display</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Error: Expected count %0d, got %0d&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, MAX_DATA, count);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        </span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // 测试用例2：基本读操作</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">        $display</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\n</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">=== Test 2: Basic read ===&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        ren = </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        repeat</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(MAX_DATA) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">begin</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            @(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">posedge</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> clk);</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">            #1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">            $display</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Read: 0x%h | Count: %0d&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, rdata, count);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        end</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        ren = </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        </span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // 验证空状态</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(count !== </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">            $display</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Error: Expected count 0, got %0d&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, count);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            </span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // 测试用例3：同时读写</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">        $display</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\n</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">=== Test 3: Concurrent R/W ===&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        wen = </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        ren = </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        repeat</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">4</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">begin</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            wdata = </span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">$random</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            @(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">posedge</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> clk);</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">            #1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">            $display</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Write: 0x%h | Read: 0x%h | Count: %0d&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                    wdata, rdata, count);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        end</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        wen = </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        ren = </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        </span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // 测试用例4：边界条件测试</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">        $display</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\n</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">=== Test 4: Boundary cases ===&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        </span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // 写满测试</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        wen = </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        repeat</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(MAX_DATA+</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">begin</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            wdata = $urandom;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            @(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">posedge</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> clk);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        end</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        wen = </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">        $display</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Overflow count: %0d&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, count);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        </span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // 读空测试</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        ren = </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        repeat</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(MAX_DATA+</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) @(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">posedge</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> clk);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        ren = </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">        $display</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Underflow count: %0d&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, count);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        </span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // 结束仿真</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">        #100</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">        $display</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\n</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">Testbench completed&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">        $finish</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    end</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // 波形记录（可选）</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    initial</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> begin</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">        $dumpfile</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;fifo.vcd&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">        $dumpvars</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, fifo_tb);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    end</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">endmodule</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>以下是对提供的 Verilog 测试平台代码的逐步解析和说明：</p><hr><h4 id="模块定义与信号声明" tabindex="-1"><a class="header-anchor" href="#模块定义与信号声明"><span><strong>模块定义与信号声明</strong></span></a></h4><div class="language-verilog line-numbers-mode" data-highlighter="shiki" data-ext="verilog" data-title="verilog" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">module</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> fifo_tb</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    parameter</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> MAX_DATA = </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">4</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;       </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// 测试深度设为4，便于快速验证</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    localparam</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> AWIDTH = $clog2(MAX_DATA); </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// AWIDTH=2 (2^2=4)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // 输入信号</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    reg</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> clk, rst;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    reg</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> wen, ren;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    reg</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">7</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">] wdata;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // 输出信号</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    wire</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">7</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">] rdata;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    wire</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [AWIDTH:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">] count;        </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// 计数器位宽=3 (0~4)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // 实例化被测FIFO</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    fifo</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> #(.MAX_DATA(MAX_DATA)) </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">dut</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (...);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>设计简化</strong>：将 FIFO 深度设为 4，加速测试并更容易观察边界条件。</li><li><strong>信号映射</strong>：测试平台的输入/输出信号与 FIFO 模块直接对接。</li></ul><hr><h3 id="_2-时钟生成" tabindex="-1"><a class="header-anchor" href="#_2-时钟生成"><span><strong>2. 时钟生成</strong></span></a></h3><div class="language-verilog line-numbers-mode" data-highlighter="shiki" data-ext="verilog" data-title="verilog" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">initial</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> clk = </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">always</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> #5</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> clk = ~clk;  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// 周期10ns，占空比50%</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>生成周期为 10ns 的时钟信号，用于驱动同步逻辑。</li></ul><hr><h3 id="_3-主测试流程" tabindex="-1"><a class="header-anchor" href="#_3-主测试流程"><span><strong>3. 主测试流程</strong></span></a></h3><h4 id="初始化与复位" tabindex="-1"><a class="header-anchor" href="#初始化与复位"><span><strong>初始化与复位</strong></span></a></h4><div class="language-verilog line-numbers-mode" data-highlighter="shiki" data-ext="verilog" data-title="verilog" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">initial</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> begin</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    wen = </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">; ren = </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">; wdata = </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">; rst = </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">    #15</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> rst = </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// 15ns后释放复位</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">end</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>初始状态：所有控制信号置零，复位信号 (<code>rst</code>) 有效。</li><li>复位释放：15ns 后 <code>rst</code> 置零，确保复位信号覆盖至少一个时钟周期。</li></ul><hr><h3 id="_4-测试用例详解" tabindex="-1"><a class="header-anchor" href="#_4-测试用例详解"><span><strong>4. 测试用例详解</strong></span></a></h3><h4 id="测试用例1-基本写操作" tabindex="-1"><a class="header-anchor" href="#测试用例1-基本写操作"><span><strong>测试用例1：基本写操作</strong></span></a></h4><div class="language-verilog line-numbers-mode" data-highlighter="shiki" data-ext="verilog" data-title="verilog" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">$display</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\n</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">=== Test 1: Basic write ===&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">wen = </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">repeat</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(MAX_DATA) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">begin</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    wdata = </span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">$random</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// 生成随机数据</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">posedge</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> clk);   </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// 等待时钟上升沿</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">    #1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;               </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// 等待信号稳定</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">    $display</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Write: 0x%h | Count: %0d&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, wdata, count);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">end</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">wen = </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>操作</strong>：连续写入 4 次随机数据。</li><li><strong>检查点</strong>： <ul><li>每次写入后计数器 <code>count</code> 应递增。</li><li>写入完成后 <code>count</code> 应等于 4，表示 FIFO 满。</li></ul></li></ul><h4 id="测试用例2-基本读操作" tabindex="-1"><a class="header-anchor" href="#测试用例2-基本读操作"><span><strong>测试用例2：基本读操作</strong></span></a></h4><div class="language-verilog line-numbers-mode" data-highlighter="shiki" data-ext="verilog" data-title="verilog" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">$display</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\n</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">=== Test 2: Basic read ===&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">ren = </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">repeat</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(MAX_DATA) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">begin</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">posedge</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> clk);</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">    #1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">    $display</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Read: 0x%h | Count: %0d&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, rdata, count);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">end</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">ren = </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>操作</strong>：连续读取 4 次数据。</li><li><strong>检查点</strong>： <ul><li>每次读取后计数器 <code>count</code> 应递减。</li><li>读取完成后 <code>count</code> 应等于 0，表示 FIFO 空。</li></ul></li></ul><h4 id="测试用例3-同时读写" tabindex="-1"><a class="header-anchor" href="#测试用例3-同时读写"><span><strong>测试用例3：同时读写</strong></span></a></h4><div class="language-verilog line-numbers-mode" data-highlighter="shiki" data-ext="verilog" data-title="verilog" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">$display</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\n</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">=== Test 3: Concurrent R/W ===&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">wen = </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">; ren = </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">repeat</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">4</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">begin</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    wdata = </span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">$random</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">posedge</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> clk);</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">    #1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">    $display</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Write: 0x%h | Read: 0x%h | Count: %0d&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, wdata, rdata, count);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">end</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>操作</strong>：同时进行 4 次写和读。</li><li><strong>检查点</strong>： <ul><li>计数器 <code>count</code> 应保持不变（读写操作抵消）。</li><li>读取的数据应比写入的数据滞后一个周期（同步 FIFO 特性）。</li></ul></li></ul><h4 id="测试用例4-边界条件测试" tabindex="-1"><a class="header-anchor" href="#测试用例4-边界条件测试"><span><strong>测试用例4：边界条件测试</strong></span></a></h4><div class="language-verilog line-numbers-mode" data-highlighter="shiki" data-ext="verilog" data-title="verilog" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">$display</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\n</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">=== Test 4: Boundary cases ===&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// 写满测试（尝试写入6次，超过容量）</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">wen = </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">repeat</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(MAX_DATA+</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">begin</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    wdata = $urandom;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">posedge</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> clk);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">end</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">wen = </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">$display</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Overflow count: %0d&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, count);  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// 预期count=6</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// 读空测试（尝试读取6次，超过容量）</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">ren = </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">repeat</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(MAX_DATA+</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) @(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">posedge</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> clk);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">ren = </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">$display</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Underflow count: %0d&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, count); </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// 预期count=7（3位无符号数）</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>操作</strong>：故意触发溢出（写满后继续写）和下溢（读空后继续读）。</li><li><strong>检查点</strong>： <ul><li><strong>溢出</strong>：<code>count</code> 超过 <code>MAX_DATA</code>（设计缺陷，需后续修复）。</li><li><strong>下溢</strong>：<code>count</code> 下溢为最大值（如 7），导致逻辑错误。</li></ul></li></ul><hr><h3 id="_5-波形记录与仿真结束" tabindex="-1"><a class="header-anchor" href="#_5-波形记录与仿真结束"><span><strong>5. 波形记录与仿真结束</strong></span></a></h3><div class="language-verilog line-numbers-mode" data-highlighter="shiki" data-ext="verilog" data-title="verilog" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">initial</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> begin</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">    $dumpfile</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;fifo.vcd&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">    $dumpvars</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, fifo_tb);  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// 记录所有信号波形</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">end</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">#100</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">$display</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\n</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">Testbench completed&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">$finish</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>使用 <code>$dumpvars</code> 生成波形文件 (<code>fifo.vcd</code>)，便于使用 GTKWave 等工具调试。</li><li>仿真结束后打印完成信息并终止。</li></ul><hr><p>该测试平台覆盖了 FIFO 的基本功能，包括正常读写、并发操作和边界条件，但需进一步完善自动检查机制以提升验证效率。通过波形分析和关键测试用例，可清晰暴露设计中的缺陷（如无空满保护），为后续修复提供依据。</p><p><strong>iverilog仿真结果</strong><br><img src="`+d+`" alt="fifo"></p><p>虽然开源的 <code>read_verilog</code> 前端在处理有效的 Verilog 输入时通常表现良好，但它提供的错误处理和报告功能并不完善。因此，在运行 Yosys 之前，强烈建议使用诸如 <code>verilator</code> 这样的外部工具。我们可以通过调用 <code>verilator --lint-only fifo.v</code> 来快速检查设计的 Verilog 语法。如果没有任何的语法错误，命令窗口就不会有任何的错误信息输出。</p><h3 id="加载设计" tabindex="-1"><a class="header-anchor" href="#加载设计"><span>加载设计</span></a></h3><p>让我们将设计加载到 Yosys 中。在命令行中，我们可以调用 <code>yosys fifo.v</code>。这将打开一个交互式的 Yosys shell 会话，并立即解析 <code>fifo.v</code> 中的代码，将其转换为抽象语法树（AST）。如果您对此过程感兴趣，可以在文档《Verilog 和 AST 前端》中找到更多信息。现在，我们只需知道这样做是为了简化设计的进一步处理。您应该会看到类似以下内容：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">yosys</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> fifo.v</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> /----------------------------------------------------------------------------\\</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> |                                                                            |</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> |  </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">yosys</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Yosys</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Open</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> SYnthesis</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Suite</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                       |</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> |                                                                            |</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> |  </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Copyright</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (C) 2012 - 2020  Claire Xenia Wolf &lt;claire@yosyshq.com&gt;         |</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> |                                                                            |</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> |  </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Permission</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> to</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> use,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> copy,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> modify,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> and/or</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> distribute</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> this</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> software</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> for</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> any</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  |</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> |  </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">purpose</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> with</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> or</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> without</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> fee</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> is</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> hereby</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> granted,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> provided</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> that</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> the</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> above</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    |</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> |  </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">copyright</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> notice</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> and</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> this</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> permission</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> notice</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> appear</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> in</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> all</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> copies.</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">         |</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> |                                                                            |</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> |  </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">THE</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> SOFTWARE</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> IS</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> PROVIDED</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;AS IS&quot;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> AND</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> THE</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> AUTHOR</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> DISCLAIMS</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ALL</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> WARRANTIES</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  |</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> |  </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">WITH</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> REGARD</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> TO</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> THIS</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> SOFTWARE</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> INCLUDING</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ALL</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> IMPLIED</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> WARRANTIES</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> OF</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">          |</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> |  </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">MERCHANTABILITY</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> AND</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> FITNESS.</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> IN</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> NO</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> EVENT</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> SHALL</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> THE</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> AUTHOR</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> BE</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> LIABLE</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> FOR</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">   |</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> |  </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ANY</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> SPECIAL,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> DIRECT,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> INDIRECT,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> OR</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> CONSEQUENTIAL</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> DAMAGES</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> OR</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ANY</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> DAMAGES</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    |</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> |  </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">WHATSOEVER</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> RESULTING</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> FROM</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> LOSS</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> OF</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> USE,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> DATA</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> OR</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> PROFITS,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> WHETHER</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> IN</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> AN</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">     |</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> |  </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ACTION</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> OF</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> CONTRACT,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> NEGLIGENCE</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> OR</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> OTHER</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> TORTIOUS</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ACTION,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ARISING</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> OUT</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> OF</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">   |</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> |  </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">OR</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> IN</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> CONNECTION</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> WITH</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> THE</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> USE</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> OR</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> PERFORMANCE</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> OF</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> THIS</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> SOFTWARE.</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            |</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> |                                                                            |</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> \\----------------------------------------------------------------------------/</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> Yosys</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0.33</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (git </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">sha1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 2584903a060</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">--</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Parsing</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> \`</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">fifo.v&#39; using frontend \` -vlog2k&#39;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">1.</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Executing Verilog-2005 frontend: fifo.v</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Parsing</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Verilog input from \`</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">fifo.v</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&#39; to AST representation.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Storing AST representation for module \`$abstract\\addr_gen&#39;</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Storing</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> AST</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> representation</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> for</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> module</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> \`</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$abstract</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\f</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">ifo&#39;.</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">Successfully finished Verilog frontend.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">yosys&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="细化" tabindex="-1"><a class="header-anchor" href="#细化"><span>细化</span></a></h3><p>现在我们已经进入了交互式 shell，可以直接调用 Yosys 命令。我们的最终目标是调用 <code>synth_ice40 -top fifo</code>，但现在我们可以单独运行每个命令，以便更好地理解每个部分在流程中的作用。我们还将从一个单独的模块 <code>addr_gen</code> 开始。</p><p>在 <code>synth_ice40</code> 的帮助输出底部是该脚本调用的完整命令列表。让我们从标记为 <code>begin</code> 的部分开始：</p><p><strong>代码清单 2</strong><br><code>begin</code> 部分</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">read_verilog</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -D</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ICE40_HX</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -lib</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -specify</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> +/ice40/cells_sim.v</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">yosys</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">read_verilog</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -D</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ICE40_HX</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -lib</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -specify</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> +/ice40/cells_sim.v</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">2.</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Executing</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Verilog-2005</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> frontend:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /usr/bin/../share/yosys/ice40/cells_sim.v</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Parsing</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Verilog</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> input</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> from</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> \`</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">/usr/bin/../share/yosys/ice40/cells_sim.v&#39; to AST representation.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Generating RTLIL representation for module \`\\SB_IO&#39;</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Generating</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> RTLIL representation for module \`</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">\\SB_GB_IO</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&#39;.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Generating RTLIL representation for module \`\\SB_GB&#39;</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Generating</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> RTLIL</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> representation</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> for</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> module</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> \`</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">\\SB_LUT4&#39;.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Generating RTLIL representation for module \`\\SB_CARRY&#39;</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Generating</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> RTLIL representation for module \`</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">\\SB_DFF</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&#39;.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Generating RTLIL representation for module \`\\SB_DFFE&#39;</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Generating</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> RTLIL</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> representation</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> for</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> module</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> \`</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">\\SB_DFFSR&#39;.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Generating RTLIL representation for module \`\\SB_DFFR&#39;</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Generating</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> RTLIL representation for module \`</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">\\SB_DFFSS</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&#39;.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Generating RTLIL representation for module \`\\SB_DFFS&#39;</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Generating</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> RTLIL</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> representation</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> for</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> module</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> \`</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">\\SB_DFFESR&#39;.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Generating RTLIL representation for module \`\\SB_DFFER&#39;</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Generating</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> RTLIL representation for module \`</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">\\SB_DFFESS</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&#39;.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Generating RTLIL representation for module \`\\SB_DFFES&#39;</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Generating</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> RTLIL</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> representation</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> for</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> module</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> \`</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">\\SB_DFFN&#39;.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Generating RTLIL representation for module \`\\SB_DFFNE&#39;</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Generating</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> RTLIL representation for module \`</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">\\SB_DFFNSR</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&#39;.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Generating RTLIL representation for module \`\\SB_DFFNR&#39;</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Generating</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> RTLIL</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> representation</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> for</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> module</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> \`</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">\\SB_DFFNSS&#39;.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Generating RTLIL representation for module \`\\SB_DFFNS&#39;</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Generating</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> RTLIL representation for module \`</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">\\SB_DFFNESR</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&#39;.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Generating RTLIL representation for module \`\\SB_DFFNER&#39;</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Generating</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> RTLIL</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> representation</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> for</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> module</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> \`</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">\\SB_DFFNESS&#39;.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Generating RTLIL representation for module \`\\SB_DFFNES&#39;</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Generating</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> RTLIL representation for module \`</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">\\SB_RAM40_4K</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&#39;.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Generating RTLIL representation for module \`\\SB_RAM40_4KNR&#39;</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Generating</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> RTLIL</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> representation</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> for</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> module</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> \`</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">\\SB_RAM40_4KNW&#39;.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Generating RTLIL representation for module \`\\SB_RAM40_4KNRNW&#39;</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Generating</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> RTLIL representation for module \`</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">\\ICESTORM_LC</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&#39;.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Generating RTLIL representation for module \`\\SB_PLL40_CORE&#39;</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Generating</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> RTLIL</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> representation</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> for</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> module</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> \`</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">\\SB_PLL40_PAD&#39;.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Generating RTLIL representation for module \`\\SB_PLL40_2_PAD&#39;</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Generating</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> RTLIL representation for module \`</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">\\SB_PLL40_2F_CORE</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&#39;.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Generating RTLIL representation for module \`\\SB_PLL40_2F_PAD&#39;</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Generating</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> RTLIL</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> representation</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> for</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> module</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> \`</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">\\SB_WARMBOOT&#39;.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Generating RTLIL representation for module \`\\SB_SPRAM256KA&#39;</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Generating</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> RTLIL representation for module \`</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">\\SB_HFOSC</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&#39;.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Generating RTLIL representation for module \`\\SB_LFOSC&#39;</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Generating</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> RTLIL</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> representation</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> for</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> module</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> \`</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">\\SB_RGBA_DRV&#39;.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Generating RTLIL representation for module \`\\SB_LED_DRV_CUR&#39;</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Generating</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> RTLIL representation for module \`</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">\\SB_RGB_DRV</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&#39;.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Generating RTLIL representation for module \`\\SB_I2C&#39;</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Generating</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> RTLIL</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> representation</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> for</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> module</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> \`</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">\\SB_SPI&#39;.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Generating RTLIL representation for module \`\\SB_LEDDA_IP&#39;</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Generating</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> RTLIL representation for module \`</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">\\SB_FILTER_50NS</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&#39;.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Generating RTLIL representation for module \`\\SB_IO_I3C&#39;</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Generating</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> RTLIL</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> representation</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> for</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> module</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> \`</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">\\SB_IO_OD&#39;.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Generating RTLIL representation for module \`\\SB_MAC16&#39;</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Generating</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> RTLIL representation for module \`</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">\\ICESTORM_RAM</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&#39;.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Successfully finished Verilog frontend.</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">yosys</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">hierarchy</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -check</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -top</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> fifo</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">5.</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Executing</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> HIERARCHY</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pass</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (managing </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">design</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> hierarchy</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">).</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">6.</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Executing</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> AST</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> frontend</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> in</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> derive</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> mode</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> using</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pre-parsed</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> AST</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> for</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> module</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> \`</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">\\fifo&#39;.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Generating RTLIL representation for module \`\\fifo&#39;</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">6.1.</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Analyzing design hierarchy..</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Top</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> module:  </span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\f</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">ifo</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Parameter</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> \\M</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">AX_DATA = </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">256</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">6.2.</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Executing AST frontend in derive mode using pre-parsed AST for module \`</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">\\addr_gen</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&#39;.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Parameter \\MAX_DATA = 256</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Generating RTLIL representation for module \`$paramod\\addr_gen\\MAX_DATA=s32&#39;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">00000000000000000000000100000000</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&#39;.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Parameter \\MAX_DATA = 256</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Found cached RTLIL representation for module \`$paramod\\addr_gen\\MAX_DATA=s32&#39;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">00000000000000000000000100000000</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&#39;.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">6.3. Analyzing design hierarchy..</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Top module:  \\fifo</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Used module:     $paramod\\addr_gen\\MAX_DATA=s32&#39;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">00000000000000000000000100000000</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">6.4.</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Analyzing</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> design</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> hierarchy..</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Top</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> module:</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">  \\f</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">ifo</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Used</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> module:</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">     $paramod</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\a</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">ddr_gen</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\M</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">AX_DATA=s32&#39;00000000000000000000000100000000</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">Removing unused module \`$abstract\\fifo&#39;.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Removing</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> unused</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> module</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> \`</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$abstract</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\a</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">ddr_gen&#39;.</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">Removed 2 unused modules.</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">yosys</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">proc</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">7.</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Executing</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> PROC</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pass</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (convert </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">processes</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> to</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> netlists</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">).</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">7.1.</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Executing</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> PROC_CLEAN</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pass</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (remove </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">empty</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> switches</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> from</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> decision</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> trees</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">).</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Cleaned</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> up</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> empty</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> switches.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">7.2.</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Executing</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> PROC_RMDEAD</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pass</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (remove </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">dead</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> branches</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> from</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> decision</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> trees</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">).</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Marked</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 2</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> switch</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> rules</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> as</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> full_case</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> in</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> process</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $proc$fifo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">.v:12</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$462</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> in</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> module</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $paramod</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\a</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">ddr_gen</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\M</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">AX_DATA=s32&#39;00000000000000000000000100000000.</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">Marked 2 switch rules as full_case in process $proc$fifo.v:62$454 in module fifo.</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">Marked 1 switch rules as full_case in process $proc$fifo.v:36$446 in module fifo.</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">Removed a total of 0 dead cases.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">7.3. Executing PROC_PRUNE pass (remove redundant assignments in processes).</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">Removed 0 redundant assignments.</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">Promoted 6 assignments to connections.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">7.4. Executing PROC_INIT pass (extract init attributes).</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">Found init rule in \`$paramod\\addr_gen\\MAX_DATA=s32&#39;00000000000000000000000100000000.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$proc$fifo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">.v:0</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$465</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;.</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  Set init value: \\addr = 8&#39;00000000</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Found</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> init</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> rule</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> in</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> \`</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">\\fifo.$proc$fifo.v:0$461&#39;.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  Set init value: \\count = 9&#39;000000000</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">7.5.</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Executing PROC_ARST pass (detect async resets in processes).</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Found</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> async reset </span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\r</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">st in \`</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$paramod</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\a</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">ddr_gen</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\M</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">AX_DATA=s32</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;00000000000000000000000100000000.$proc$fifo.v:12$462&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Found</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> async</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> reset</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> \\r</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">st</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> in</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> \`</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">\\fifo.$proc$fifo.v:62$454&#39;.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">7.6. Executing PROC_ROM pass (convert switches to ROMs).</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Converted 0 switches.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&lt;suppressed ~5 debug messages&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">7.7. Executing PROC_MUX pass (convert decision trees to multiplexers).</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Creating decoders for process \`$paramod\\addr_gen\\MAX_DATA=s32&#39;00000000000000000000000100000000.$proc$fifo.v:0$465&#39;.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Creating decoders for process \`$paramod\\addr_gen\\MAX_DATA=s32&#39;00000000000000000000000100000000.$proc$fifo.v:12$462&#39;.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">     1/1: $0\\addr[7:0]</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Creating decoders for process \`\\fifo.$proc$fifo.v:0$461&#39;</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Creating</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> decoders for process \`</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">\\fifo.$proc$fifo.v:62$454</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&#39;.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">     1/1: $0\\count[8:0]</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Creating decoders for process \`\\fifo.$proc$fifo.v:36$446&#39;</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">     1/3:</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> $1</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$memwr</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">$</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\d</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">ata</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$fifo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">.v:38</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$445_EN</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">[7:0]</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$452</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">     2/3:</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> $1</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$memwr</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">$</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\d</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">ata</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$fifo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">.v:38</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$445_DATA</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">[7:0]</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$451</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">     3/3:</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> $1</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$memwr</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">$</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\d</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">ata</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$fifo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">.v:38</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$445_ADDR</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">[7:0]</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$450</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">7.8.</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Executing</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> PROC_DLATCH</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pass</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (convert </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">process</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> syncs</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> to</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> latches</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">).</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">7.9.</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Executing</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> PROC_DFF</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pass</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (convert </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">process</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> syncs</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> to</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> FFs</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">).</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Creating</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> register</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> for</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> signal</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> \`</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$paramod</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\a</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">ddr_gen</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\M</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">AX_DATA=s32&#39;00000000000000000000000100000000.\\addr&#39; using process \`</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$paramod</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\a</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">ddr_gen</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\M</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">AX_DATA=s32</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;00000000000000000000000100000000.$proc$fifo.v:12$462&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  created</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $adff</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> cell</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> \`</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$procdff$485</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39; with positive edge clock and positive level reset.</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">Creating register for signal \`\\fifo.\\count&#39; using process \`</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">\\fifo.$proc$fifo.v:62$454</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&#39;.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  created $adff cell \`$procdff$486&#39;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> with</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> positive</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> edge</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> clock</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> and</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> positive</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> level</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> reset.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Creating</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> register</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> for</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> signal</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> \`</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">\\fifo.\\rdata&#39; using process \`\\fifo.$proc$fifo.v:36$446&#39;</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  created</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $dff</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> cell \`</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$procdff$487</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39; with positive edge clock.</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">Creating register for signal \`\\fifo.$memwr$\\data$fifo.v:38$445_ADDR&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> using process </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">\`</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">\\fifo.$proc$fifo.v:36$446&#39;.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  created $dff cell \`$procdff$488&#39;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> with positive edge clock.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Creating</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> register for signal \`</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">\\fifo.$memwr$\\data$fifo.v:38$445_DATA</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&#39; using process \`\\fifo.$proc$fifo.v:36$446&#39;</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  created</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $dff</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> cell</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> \`</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$procdff$489</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39; with positive edge clock.</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">Creating register for signal \`\\fifo.$memwr$\\data$fifo.v:38$445_EN&#39; using process \`</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">\\fifo.$proc$fifo.v:36$446</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&#39;.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  created $dff cell \`$procdff$490&#39;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> with</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> positive</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> edge</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> clock.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">7.10.</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Executing</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> PROC_MEMWR</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pass</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (convert </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">process</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> memory</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> writes</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> to</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> cells</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">).</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">7.11.</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Executing</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> PROC_CLEAN</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pass</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (remove </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">empty</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> switches</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> from</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> decision</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> trees</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">).</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Removing</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> empty</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> process</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> \`</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$paramod</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\a</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">ddr_gen</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\M</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">AX_DATA=s32&#39;00000000000000000000000100000000.$proc$fifo.v:0$465&#39;.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Found</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> and cleaned up </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> empty switches in \`</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$paramod</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\a</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">ddr_gen</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\M</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">AX_DATA=s32</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;00000000000000000000000100000000.$proc$fifo.v:12$462&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Removing</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> empty</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> process</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> \`</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$paramod</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\a</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">ddr_gen</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\M</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">AX_DATA=s32&#39;00000000000000000000000100000000.$proc$fifo.v:12$462&#39;.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Removing</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> empty process \`</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">fifo.$proc$fifo.v:0$461</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&#39;.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Found and cleaned up 2 empty switches in \`\\fifo.$proc$fifo.v:62$454&#39;</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Removing</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> empty</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> process</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> \`</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">fifo.$proc$fifo.v:62$454&#39;.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Found and cleaned up 1 empty switch in \`\\fifo.$proc$fifo.v:36$446&#39;</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Removing</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> empty process \`</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">fifo.$proc$fifo.v:36$446</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&#39;.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Cleaned up 5 empty switches.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">7.12. Executing OPT_EXPR pass (perform const folding).</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Optimizing module $paramod\\addr_gen\\MAX_DATA=s32&#39;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">00000000000000000000000100000000.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Optimizing</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> module</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> fifo.</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>read_verilog -D ICE40_HX -lib -specify +/ice40/cells_sim.v</code> 加载了 iCE40 的单元模型，这使我们能够在设计中包含平台特定的 IP 块。PLL 是一个常见的例子，我们可能需要直接引用 <code>SB_PLL40_CORE</code>，而不是依赖后续的映射过程。由于我们的简单设计没有使用这些 IP 块，我们可以暂时跳过这个命令。不过，一旦我们开始映射到硬件，仍然需要加载这些单元模型。</p><p><strong>注意</strong></p><p><code>+/</code> 是对 Yosys 共享目录的动态引用。默认情况下，这是 <code>/usr/local/share/yosys</code>。如果使用从源代码目录本地构建的 Yosys 版本，这将是同一目录中的 <code>share</code> 文件夹。</p><p>最后输入<code>exit</code>退出Yosys程序。</p><h3 id="addr-gen-模块" tabindex="-1"><a class="header-anchor" href="#addr-gen-模块"><span><code>addr_gen</code> 模块</span></a></h3><p>由于我们刚刚开始，让我们从 <code>hierarchy -top addr_gen</code> 开始。该命令声明顶层模块是 <code>addr_gen</code>，其他所有内容都可以丢弃。</p><p><strong>代码清单 3</strong><br><code>addr_gen.v</code> 模块源代码</p><div class="language-verilog line-numbers-mode" data-highlighter="shiki" data-ext="verilog" data-title="verilog" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">module</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> addr_gen</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">#(  </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">parameter</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> MAX_DATA=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">256</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">	localparam</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> AWIDTH = $clog2(MAX_DATA)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) ( </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">input</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> en, clk, rst,</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">	output</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> reg</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [AWIDTH-</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">] addr</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">	initial</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> addr = </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	// 异步复位</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	// 当使能时递增地址</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">	always</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> @(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">posedge</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> clk </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">or</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> posedge</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> rst)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">		if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (rst)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">			addr &lt;= </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">		else</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (en) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">begin</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">			if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ({&#39;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, addr} == MAX_DATA-</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">				addr &lt;= </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">			else</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">				addr &lt;= addr + </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">		end</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">endmodule</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> //addr_gen</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>以下是对所提供Verilog代码的详细解析：</p><hr><h4 id="模块定义与参数" tabindex="-1"><a class="header-anchor" href="#模块定义与参数"><span>模块定义与参数</span></a></h4><div class="language-verilog line-numbers-mode" data-highlighter="shiki" data-ext="verilog" data-title="verilog" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">module</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> addr_gen</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">#(  </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">parameter</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> MAX_DATA=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">256</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    localparam</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> AWIDTH = $clog2(MAX_DATA)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) (</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    input</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> en, clk, rst,</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    output</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> reg</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [AWIDTH-</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">] addr</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>功能</strong>：该模块用于生成循环递增的地址。</li><li><strong>参数</strong>： <ul><li><code>MAX_DATA</code>：地址范围的最大值，默认为256。</li><li><code>AWIDTH</code>：地址位宽，由<code>$clog2(MAX_DATA)</code>自动计算得出。若<code>MAX_DATA=256</code>，则<code>AWIDTH=8</code>。</li></ul></li><li><strong>端口</strong>： <ul><li><code>en</code>：使能信号，控制地址递增。</li><li><code>clk</code>：时钟信号。</li><li><code>rst</code>：异步复位信号。</li><li><code>addr</code>：输出地址，位宽为<code>AWIDTH</code>。</li></ul></li></ul><hr><h4 id="初始值设置" tabindex="-1"><a class="header-anchor" href="#初始值设置"><span>初始值设置</span></a></h4><div class="language-verilog line-numbers-mode" data-highlighter="shiki" data-ext="verilog" data-title="verilog" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">initial</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> addr = </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li><strong>行为</strong>：在仿真开始时，将<code>addr</code>初始化为0。</li><li><strong>注意</strong>：<code>initial</code>语句在综合中可能被忽略，实际硬件行为由复位逻辑决定。</li></ul><hr><h4 id="核心逻辑" tabindex="-1"><a class="header-anchor" href="#核心逻辑"><span>核心逻辑</span></a></h4><div class="language-verilog line-numbers-mode" data-highlighter="shiki" data-ext="verilog" data-title="verilog" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">always</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> @(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">posedge</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> clk </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">or</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> posedge</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> rst)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (rst)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        addr &lt;= </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    else</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (en) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">begin</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ({&#39;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, addr} == MAX_DATA-</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            addr &lt;= </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        else</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            addr &lt;= addr + </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    end</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>异步复位</strong>：当<code>rst</code>为高电平时，立即将<code>addr</code>清零。</li><li><strong>递增逻辑</strong>： <ul><li>在时钟上升沿，若<code>en</code>有效且未复位，则执行以下操作： <ol><li><strong>循环检查</strong>：比较当前地址<code>addr</code>是否等于<code>MAX_DATA-1</code>。 <ul><li><code>{&#39;0, addr}</code>：将<code>addr</code>高位补零，扩展至与<code>MAX_DATA-1</code>相同位宽，确保比较正确性。</li></ul></li><li><strong>归零或递增</strong>： <ul><li>若相等，<code>addr</code>归零，实现循环。</li><li>否则，<code>addr</code>加1。</li></ul></li></ol></li></ul></li></ul><hr><h4 id="关键设计点" tabindex="-1"><a class="header-anchor" href="#关键设计点"><span>关键设计点</span></a></h4><ol><li><p><strong>地址位宽计算</strong>：</p><ul><li><code>$clog2(MAX_DATA)</code>确保地址位宽最小化。例如： <ul><li><code>MAX_DATA=1000</code> → <code>AWIDTH=10</code>（因<code>2^10=1024 ≥ 1000</code>）。</li><li><code>MAX_DATA=256</code> → <code>AWIDTH=8</code>。</li></ul></li></ul></li><li><p><strong>循环行为</strong>：</p><ul><li>地址在<code>0</code>到<code>MAX_DATA-1</code>之间循环，严格限制在用户定义范围内。</li><li>例：若<code>MAX_DATA=200</code>，地址范围为<code>0~199</code>，到达199后归零。</li></ul></li><li><p><strong>复位与初始化</strong>：</p><ul><li>异步复位确保立即响应复位信号。</li><li><code>initial</code>语句仅用于仿真，实际硬件依赖复位信号初始化。</li></ul></li><li><p><strong>位宽扩展</strong>：</p><ul><li><code>{&#39;0, addr}</code>显式扩展位宽，避免比较时的隐式符号扩展问题，增强代码健壮性。</li></ul></li></ol><hr><h4 id="潜在问题与改进" tabindex="-1"><a class="header-anchor" href="#潜在问题与改进"><span>潜在问题与改进</span></a></h4><ol><li><p><strong><code>MAX_DATA</code>非2的幂</strong>：</p><ul><li>若<code>MAX_DATA=300</code>，<code>AWIDTH=9</code>（<code>2^9=512</code>），地址最大值为<code>299</code>，此时逻辑正确。</li><li>但若<code>en</code>持续有效且外部未限制，地址仍会从<code>299</code>归零，无越界风险。</li></ul></li><li><p><strong>综合与初始化</strong>：</p><ul><li>实际硬件中，建议依赖复位信号而非<code>initial</code>语句初始化寄存器。</li></ul></li><li><p><strong>位宽优化</strong>：</p><ul><li><code>{&#39;0, addr}</code>可简化为<code>addr</code>，因Verilog默认无符号数高位补零比较，但显式扩展更清晰。</li></ul></li></ol><hr><h4 id="应用场景" tabindex="-1"><a class="header-anchor" href="#应用场景"><span>应用场景</span></a></h4><ul><li><strong>存储器访问</strong>：循环遍历存储器的连续地址。</li><li><strong>状态机控制</strong>：生成周期性状态或索引。</li><li><strong>数据流管理</strong>：控制缓冲区的读写指针。</li></ul><hr><h4 id="示例波形" tabindex="-1"><a class="header-anchor" href="#示例波形"><span>示例波形</span></a></h4><ul><li><strong>复位阶段</strong>：<code>rst=1</code> → <code>addr=0</code>。</li><li><strong>递增阶段</strong>：<code>rst=0, en=1</code> → <code>addr</code>每周期加1。</li><li><strong>循环归零</strong>：当<code>addr=MAX_DATA-1</code>时，下一周期归零。</li></ul><hr><h3 id="测试流程" tabindex="-1"><a class="header-anchor" href="#测试流程"><span>测试流程</span></a></h3><p><strong>代码清单 4</strong><br><code>tb_addr_gen.v</code> 模块testbench</p><div class="language-verilog line-numbers-mode" data-highlighter="shiki" data-ext="verilog" data-title="verilog" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">\`timescale</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> 1ns/1ps</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">module</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> tb_addr_gen</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    reg</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> clk = </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    reg</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> rst, en;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    wire</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">7</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">] addr;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    addr_gen</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> #(.MAX_DATA(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">256</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)) </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">uut</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        .en(en),</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        .clk(clk),</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        .rst(rst),</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        .addr(addr)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    );</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // 生成时钟（10ns周期）</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    always</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> #5</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> clk = ~clk;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    integer</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> i;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    reg</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">7</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">] expected;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    initial</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> begin</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">        $dumpfile</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;tb_addr_gen.vcd&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">        $dumpvars</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, tb_addr_gen);  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// 记录所有信号</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // 初始化信号</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        rst = </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        en = </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">        #20</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> rst = </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// 复位释放</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // 测试1：en=0时地址不变</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        en = </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        repeat</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) @(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">posedge</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> clk);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (addr !== </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">8&#39;d0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) $error(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Test1 Failed&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        else</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> $display</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Test1 Passed&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // 测试2：地址递增至255后回绕</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        en = </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        expected = </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        for</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (i = </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">; i &lt; </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">256</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">; i = i + </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">begin</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            @(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">posedge</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> clk);</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">            #1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (addr !== expected) $error(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Test2 Failed at step %0d&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, i);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            expected = (expected == </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">255</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) ? </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> : expected + </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        end</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">        $display</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Test2 Passed&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // 测试3：回绕后继续递增</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        @(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">posedge</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> clk);</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">        #1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (addr !== </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">8&#39;d1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) $error(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Test3 Failed&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        else</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> $display</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Test3 Passed&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // 测试4：en=0时地址不变</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        en = </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        repeat</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) @(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">posedge</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> clk);</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">        #1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (addr !== </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">8&#39;d1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) $error(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Test4 Failed&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        else</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> $display</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Test4 Passed&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // 测试5：异步复位</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        en = </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        @(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">negedge</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> clk);  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// 在时钟低电平触发复位</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        rst = </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">        #1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (addr !== </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">8&#39;d0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) $error(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Test5 Failed&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        @(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">posedge</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> clk);</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">        #1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (addr !== </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">8&#39;d0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) $error(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Test5 Failed&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        rst = </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">        $display</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Test5 Passed&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">        $display</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;All Tests Passed&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">        $finish</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    end</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">endmodule</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>以下是代码的详细解析：</p><h3 id="模块结构" tabindex="-1"><a class="header-anchor" href="#模块结构"><span>模块结构</span></a></h3><div class="language-verilog line-numbers-mode" data-highlighter="shiki" data-ext="verilog" data-title="verilog" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">\`timescale</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> 1ns/1ps</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">module</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> tb_addr_gen</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    reg</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> clk = </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    reg</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> rst, en;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    wire</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">7</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">] addr;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    addr_gen</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> #(.MAX_DATA(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">256</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)) </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">uut</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (.en(en), .clk(clk), .rst(rst), .addr(addr));</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    always</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> #5</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> clk = ~clk;  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// 10ns周期时钟</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>时钟生成</strong>：通过<code>always</code>块生成周期为10ns（5ns高电平+5ns低电平）的时钟信号。</li><li><strong>实例化被测模块</strong>：<code>addr_gen</code>模块被实例化为<code>uut</code>，设置最大数据<code>MAX_DATA</code>为256，对应8位地址线。</li></ul><hr><h4 id="_1-初始化" tabindex="-1"><a class="header-anchor" href="#_1-初始化"><span>1. 初始化</span></a></h4><div class="language-verilog line-numbers-mode" data-highlighter="shiki" data-ext="verilog" data-title="verilog" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">$dumpfile</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;tb_addr_gen.vcd&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">$dumpvars</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, tb_addr_gen);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">rst = </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">; en = </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">#20</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> rst = </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// 复位20ns后释放</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>初始化波形记录文件和信号。</li><li>复位信号<code>rst</code>保持高电平20ns后释放，确保模块初始状态正确。</li></ul><hr><h4 id="_2-测试1-en-0时地址不变" tabindex="-1"><a class="header-anchor" href="#_2-测试1-en-0时地址不变"><span>2. 测试1：<code>en=0</code>时地址不变</span></a></h4><div class="language-verilog line-numbers-mode" data-highlighter="shiki" data-ext="verilog" data-title="verilog" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">en = </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">repeat</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) @(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">posedge</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> clk);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (addr !== </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">8&#39;d0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) $error(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Test1 Failed&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>使能信号<code>en</code>置0，等待2个时钟周期。</li><li>验证地址<code>addr</code>保持初始值0，确认模块在非使能状态下不递增。</li></ul><hr><h4 id="_3-测试2-地址递增至255后回绕" tabindex="-1"><a class="header-anchor" href="#_3-测试2-地址递增至255后回绕"><span>3. 测试2：地址递增至255后回绕</span></a></h4><div class="language-verilog line-numbers-mode" data-highlighter="shiki" data-ext="verilog" data-title="verilog" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">en = </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">expected = </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">for</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (i=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">; i&lt;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">256</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">; i=i+</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">begin</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">posedge</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> clk);</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">    #1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// 等待信号稳定</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (addr !== expected) $error(...);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    expected = (expected==</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">255</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) ? </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> : expected+</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>使能信号<code>en</code>置1，循环256次，每次检查地址是否正确递增。</li><li><code>expected</code>变量跟踪预期值，达到255后归零，验证地址回绕功能。</li></ul><hr><h4 id="_4-测试3-回绕后继续递增" tabindex="-1"><a class="header-anchor" href="#_4-测试3-回绕后继续递增"><span>4. 测试3：回绕后继续递增</span></a></h4><div class="language-verilog line-numbers-mode" data-highlighter="shiki" data-ext="verilog" data-title="verilog" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">posedge</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> clk);</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">#1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (addr !== </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">8&#39;d1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) $error(...);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>在测试2结束后，下一个时钟周期检查地址是否从0递增到1，确认回绕逻辑正确。</li></ul><hr><h4 id="_5-测试4-再次验证en-0时地址不变" tabindex="-1"><a class="header-anchor" href="#_5-测试4-再次验证en-0时地址不变"><span>5. 测试4：再次验证<code>en=0</code>时地址不变</span></a></h4><div class="language-verilog line-numbers-mode" data-highlighter="shiki" data-ext="verilog" data-title="verilog" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">en = </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">repeat</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) @(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">posedge</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> clk);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (addr !== </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">8&#39;d1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) $error(...);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>再次禁用使能信号，等待2个周期后地址应保持1，确保模块在非使能状态下冻结地址。</li></ul><hr><h4 id="_6-测试5-异步复位测试" tabindex="-1"><a class="header-anchor" href="#_6-测试5-异步复位测试"><span>6. 测试5：异步复位测试</span></a></h4><div class="language-verilog line-numbers-mode" data-highlighter="shiki" data-ext="verilog" data-title="verilog" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">en = </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">negedge</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> clk);  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// 时钟低电平时触发复位</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">rst = </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">#1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (addr !== </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">8&#39;d0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) $error(...);  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// 立即检查复位生效</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">posedge</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> clk);</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">#1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (addr !== </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">8&#39;d0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) $error(...);  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// 时钟上升沿后保持0</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">rst = </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>在时钟低电平时激活复位，验证地址立即归零（异步复位特性）。</li><li>下一个上升沿后地址仍为0，确认复位释放后模块从0开始。</li></ul><hr><h3 id="关键设计要点" tabindex="-1"><a class="header-anchor" href="#关键设计要点"><span>关键设计要点</span></a></h3><ol><li><strong>复位机制</strong>：测试5验证了复位是异步的，立即生效且独立于时钟。</li><li><strong>使能控制</strong>：通过<code>en</code>信号控制地址递增，确保模块仅在使能时工作。</li><li><strong>边界条件</strong>：测试2覆盖了地址从0到255的全范围，验证回绕逻辑。</li><li><strong>时序检查</strong>：使用<code>#1</code>延迟避开时序竞争，确保采样时信号稳定。</li></ol><hr><h3 id="潜在改进点" tabindex="-1"><a class="header-anchor" href="#潜在改进点"><span>潜在改进点</span></a></h3><ul><li><strong>随机化测试</strong>：可加入随机化的<code>en</code>和<code>rst</code>信号，增强测试覆盖率。</li><li><strong>错误注入</strong>：模拟极端情况（如复位在地址255时触发）。</li><li><strong>代码复用</strong>：将重复的测试逻辑封装为任务或函数，提高可维护性。</li></ul><p>此测试平台全面验证了<code>addr_gen</code>模块的核心功能，包括正常递增、回绕、使能控制和异步复位，确保了模块的可靠性。</p><p><strong>仿真结果</strong></p><p><img src="`+r+`" alt="addr_gen"></p><p>首先输入命令：<code>yosys addr_gen.v</code>，可以得到下面的结果</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> /----------------------------------------------------------------------------\\</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> |                                                                            |</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> |  </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">yosys</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Yosys</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Open</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> SYnthesis</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Suite</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                       |</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> |                                                                            |</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> |  </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Copyright</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (C) 2012 - 2020  Claire Xenia Wolf &lt;claire@yosyshq.com&gt;         |</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> |                                                                            |</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> |  </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Permission</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> to</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> use,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> copy,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> modify,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> and/or</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> distribute</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> this</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> software</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> for</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> any</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  |</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> |  </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">purpose</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> with</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> or</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> without</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> fee</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> is</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> hereby</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> granted,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> provided</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> that</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> the</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> above</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    |</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> |  </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">copyright</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> notice</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> and</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> this</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> permission</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> notice</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> appear</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> in</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> all</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> copies.</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">         |</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> |                                                                            |</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> |  </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">THE</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> SOFTWARE</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> IS</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> PROVIDED</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;AS IS&quot;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> AND</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> THE</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> AUTHOR</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> DISCLAIMS</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ALL</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> WARRANTIES</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  |</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> |  </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">WITH</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> REGARD</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> TO</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> THIS</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> SOFTWARE</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> INCLUDING</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ALL</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> IMPLIED</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> WARRANTIES</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> OF</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">          |</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> |  </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">MERCHANTABILITY</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> AND</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> FITNESS.</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> IN</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> NO</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> EVENT</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> SHALL</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> THE</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> AUTHOR</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> BE</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> LIABLE</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> FOR</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">   |</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> |  </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ANY</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> SPECIAL,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> DIRECT,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> INDIRECT,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> OR</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> CONSEQUENTIAL</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> DAMAGES</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> OR</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ANY</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> DAMAGES</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    |</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> |  </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">WHATSOEVER</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> RESULTING</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> FROM</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> LOSS</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> OF</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> USE,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> DATA</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> OR</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> PROFITS,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> WHETHER</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> IN</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> AN</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">     |</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> |  </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ACTION</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> OF</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> CONTRACT,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> NEGLIGENCE</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> OR</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> OTHER</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> TORTIOUS</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ACTION,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ARISING</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> OUT</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> OF</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">   |</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> |  </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">OR</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> IN</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> CONNECTION</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> WITH</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> THE</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> USE</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> OR</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> PERFORMANCE</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> OF</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> THIS</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> SOFTWARE.</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            |</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> |                                                                            |</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> \\----------------------------------------------------------------------------/</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> Yosys</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0.33</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (git </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">sha1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 2584903a060</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">--</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Parsing</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> \`</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">addr_gen.v&#39; using frontend \` -vlog2k&#39;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">1.</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Executing Verilog-2005 frontend: addr_gen.v</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Parsing</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Verilog input from \`</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">addr_gen.v</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&#39; to AST representation.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Storing AST representation for module \`$abstract\\addr_gen&#39;</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Successfully</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> finished</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Verilog</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> frontend.</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>注意</strong></p><p><code>hierarchy</code> 应该始终是在设计读取后调用的第一个命令。通过指定顶层模块，<code>hierarchy</code> 还会在其上设置 <code>(* top *)</code> 属性。其他需要知道哪个模块是顶层的命令会使用此属性。</p><p><strong>代码清单 4</strong><br><code>hierarchy -top addr_gen</code> 输出</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>yosys&gt; hierarchy -top addr_gen</span></span>
<span class="line"><span></span></span>
<span class="line"><span>2. Executing HIERARCHY pass (managing design hierarchy).</span></span>
<span class="line"><span></span></span>
<span class="line"><span>3. Executing AST frontend in derive mode using pre-parsed AST for module \`\\addr_gen&#39;.</span></span>
<span class="line"><span>Generating RTLIL representation for module \`\\addr_gen&#39;.</span></span>
<span class="line"><span></span></span>
<span class="line"><span>3.1. Analyzing design hierarchy..</span></span>
<span class="line"><span>Top module:  \\addr_gen</span></span>
<span class="line"><span></span></span>
<span class="line"><span>3.2. Analyzing design hierarchy..</span></span>
<span class="line"><span>Top module:  \\addr_gen</span></span>
<span class="line"><span>Removing unused module \`$abstract\\addr_gen&#39;.</span></span>
<span class="line"><span>Removed 1 unused modules.</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>现在，输入命令<code>show</code>，我们的 <code>addr_gen</code> 电路看起来像这样： 输入命令</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">show</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><img src="`+A+`" alt="addr_gen"></p><h3 id="简单操作的处理" tabindex="-1"><a class="header-anchor" href="#简单操作的处理"><span>简单操作的处理</span></a></h3><p>在 <code>addr_gen</code> 模块的源代码中，像 <code>addr + 1</code> 和 <code>addr == MAX_DATA-1</code> 这样的简单操作可以从 <code>always @</code> 块中提取出来。这为我们提供了高亮的 <code>$add</code> 和 <code>$eq</code> 单元。然而，控制逻辑（如 <code>if .. else</code>）和存储元素（如 <code>addr &lt;= 0</code>）则不那么直接。这些内容被放入“进程”中，在原理图中显示为 <code>PROC</code>。注意第二行引用了对应 <code>always @</code> 块的起始/结束行号。如果是 <code>initial</code> 块，我们会看到 <code>PROC</code> 引用第 0 行。</p><p>为了处理这些内容，我们现在引入下一个命令：<code>proc</code> —— 将进程转换为网表。<code>proc</code> 是一个类似于 <code>synth_ice40</code> 的宏命令。它不会直接修改设计，而是调用一系列其他命令。在 <code>proc</code> 的情况下，这些子命令将进程的行为逻辑转换为多路复用器和寄存器。让我们看看运行它时会发生什么。现在，我们将调用 <code>proc -noopt</code> 以防止一些通常会自动发生的优化。</p><h3 id="运行-proc-noopt" tabindex="-1"><a class="header-anchor" href="#运行-proc-noopt"><span>运行 <code>proc -noopt</code></span></a></h3><p>当我们运行 <code>proc -noopt</code> 时，设计中的进程会被转换为更底层的逻辑单元。具体来说：</p><ol><li><strong>控制逻辑</strong>：<code>if .. else</code> 语句会被转换为多路复用器（<code>$mux</code> 单元）。</li><li><strong>存储元素</strong>：寄存器赋值（如 <code>addr &lt;= 0</code>）会被转换为触发器（<code>$dff</code> 或 <code>$adff</code> 单元）。</li></ol><p>在运行 <code>proc -noopt</code> 后，设计中的 <code>always @</code> 块会被分解为多个基本单元。例如：</p><ul><li><code>if (rst)</code> 会被转换为一个多路复用器，用于选择复位值或正常操作值。</li><li><code>addr &lt;= addr + 1</code> 会被转换为一个加法器（<code>$add</code> 单元）和一个触发器（<code>$dff</code> 单元）。</li></ul><h3 id="示例输出" tabindex="-1"><a class="header-anchor" href="#示例输出"><span>示例输出</span></a></h3><p>运行 <code>proc -noopt</code> 后，您可能会看到类似以下的输出：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">yosys</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">proc</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -noopt</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">5.</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Executing</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> PROC</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pass</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (convert </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">processes</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> to</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> netlists</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">).</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">5.1.</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Executing</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> PROC_CLEAN</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pass</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (remove </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">empty</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> switches</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> from</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> decision</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> trees</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">).</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Cleaned</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> up</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> empty</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> switches.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">5.2.</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Executing</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> PROC_RMDEAD</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pass</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (remove </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">dead</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> branches</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> from</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> decision</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> trees</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">).</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Marked</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 2</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> switch</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> rules</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> as</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> full_case</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> in</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> process</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $proc$addr_gen</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">.v:11</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">$1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> in</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> module</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> addr_gen.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Removed</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> a</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> total</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> of</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> dead</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> cases.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">5.3.</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Executing</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> PROC_PRUNE</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pass</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (remove </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">redundant</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> assignments</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> in</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> processes</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">).</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Removed</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> redundant</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> assignments.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Promoted</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> assignment</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> to</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> connection.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">5.4.</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Executing</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> PROC_INIT</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pass</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (extract </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">init</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> attributes</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">).</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Found</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> init</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> rule</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> in</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> \`</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">\\addr_gen.$proc$addr_gen.v:0$4&#39;.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  Set init value: \\addr = 8&#39;00000000</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">5.5.</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Executing PROC_ARST pass (detect async resets in processes).</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Found</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> async reset </span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\r</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">st in \`</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">\\addr_gen.$proc$addr_gen.v:11$1</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&#39;.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">5.6. Executing PROC_ROM pass (convert switches to ROMs).</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Converted 0 switches.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&lt;suppressed ~2 debug messages&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">5.7. Executing PROC_MUX pass (convert decision trees to multiplexers).</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Creating decoders for process \`\\addr_gen.$proc$addr_gen.v:0$4&#39;</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Creating</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> decoders</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> for</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> process</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> \`</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">\\addr_gen.$proc$addr_gen.v:11$1&#39;.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">     1/1: $0\\addr[7:0]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">5.8. Executing PROC_DLATCH pass (convert process syncs to latches).</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">5.9. Executing PROC_DFF pass (convert process syncs to FFs).</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Creating register for signal \`\\addr_gen.\\addr&#39;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> using process \`</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">\\addr_gen.$proc$addr_gen.v:11$1</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&#39;.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  created $adff cell \`$procdff$10&#39;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> with</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> positive</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> edge</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> clock</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> and</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> positive</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> level</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> reset.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">5.10.</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Executing</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> PROC_MEMWR</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pass</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (convert </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">process</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> memory</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> writes</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> to</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> cells</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">).</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">5.11.</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Executing</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> PROC_CLEAN</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pass</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (remove </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">empty</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> switches</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> from</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> decision</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> trees</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">).</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Removing</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> empty</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> process</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> \`</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">addr_gen.$proc$addr_gen.v:0$4&#39;.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Found and cleaned up 2 empty switches in \`\\addr_gen.$proc$addr_gen.v:11$1&#39;</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Removing</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> empty process \`</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">addr_gen.$proc$addr_gen.v:11$1</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&#39;.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Cleaned up 2 empty switches.</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="原理图变化" tabindex="-1"><a class="header-anchor" href="#原理图变化"><span>原理图变化</span></a></h3><p>再次输入命令<code>show</code>可以得到新的原理图： <img src="`+g+`" alt="addr_gen"> 在原理图中，您会看到以下变化：</p><ul><li><strong>多路复用器</strong>：<code>if .. else</code> 逻辑被转换为 <code>$mux</code> 单元。</li><li><strong>触发器</strong>：寄存器赋值被转换为 <code>$adff</code> 单元。</li><li><strong>加法器</strong>：<code>addr + 1</code> 被转换为 <code>$add</code> 单元。</li></ul><h3 id="处理-proc-noopt-后的设计" tabindex="-1"><a class="header-anchor" href="#处理-proc-noopt-后的设计"><span>处理 <code>proc -noopt</code> 后的设计</span></a></h3><p>在运行 <code>proc -noopt</code> 之后，我们的设计中新增了一些单元，这些单元已被高亮显示。具体来说：</p><ul><li><strong><code>if</code> 语句</strong>：现在被建模为 <code>$mux</code> 单元。</li><li><strong>寄存器</strong>：使用 <code>$adff</code> 单元来实现。</li></ul><p>如果我们查看终端输出，还可以看到所有不同的 <code>proc_*</code> 命令被调用。我们将在<strong>转换进程块</strong>部分更详细地探讨这些命令。</p><h3 id="浮空线的处理" tabindex="-1"><a class="header-anchor" href="#浮空线的处理"><span>浮空线的处理</span></a></h3><p>在 <code>proc -noopt</code> 之后的 <code>addr_gen</code> 模块的左上角，我们有一个浮空的线。这条线是由 <code>addr</code> 线的初始赋值 <code>0</code> 生成的。然而，这个初始赋值是不可综合的，因此在生成物理硬件之前需要清理。</p><h3 id="清理和优化" tabindex="-1"><a class="header-anchor" href="#清理和优化"><span>清理和优化</span></a></h3><p>在运行 <code>proc -noopt</code> 后，设计可能会包含一些冗余的逻辑或未连接的线。为了清理这些内容，我们可以运行以下命令：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">yosys</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">opt_expr</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">clean</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">7.</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Executing</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> OPT_EXPR</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pass</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (perform </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">const</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> folding</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">).</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Optimizing</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> module</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> addr_gen.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Removed</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> unused</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> cells</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> and</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 4</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> unused</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> wire</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong><code>opt_expr</code></strong>：执行常量折叠和简单的表达式优化。</li><li><strong><code>clean</code></strong>：移除未使用的单元和线。</li></ul><p>通过运行 <code>proc -noopt</code>，我们将设计中的行为逻辑转换为底层的逻辑单元，如多路复用器和触发器。这为后续的优化和硬件映射奠定了基础。接下来，我们可以通过 <code>opt_expr</code> 和 <code>clean</code> 进一步优化和清理设计。</p><p><strong>注意</strong>：<code>proc</code> 是综合流程中的一个关键步骤，它将高级的行为描述转换为可综合的低级网表。理解这一过程对于掌握 FPGA 综合流程非常重要。</p><h4 id="opt-expr-的作用" tabindex="-1"><a class="header-anchor" href="#opt-expr-的作用"><span><code>opt_expr</code> 的作用</span></a></h4><ul><li><strong>常量折叠</strong>：将常量表达式计算为单个值。</li><li><strong>简单表达式优化</strong>：简化逻辑表达式，例如 <code>a + 0</code> 会被优化为 <code>a</code>。</li></ul><h4 id="clean-的作用" tabindex="-1"><a class="header-anchor" href="#clean-的作用"><span><code>clean</code> 的作用</span></a></h4><ul><li><strong>移除未使用的单元和线</strong>：清理设计中未连接或未使用的部分，以减少冗余。</li></ul><h3 id="原理图变化-1" tabindex="-1"><a class="header-anchor" href="#原理图变化-1"><span>原理图变化</span></a></h3><p>继续输入命令<code>show</code>可以得到新的原理图 <img src="`+c+`" alt="addr_gen"> 在清理和优化之后，原理图会发生以下变化：</p><ul><li><strong>浮空线被移除</strong>：初始赋值生成的浮空线被清理。</li><li><strong>逻辑简化</strong>：<code>opt_expr</code> 可能会将一些复杂的逻辑表达式简化为更简单的形式。</li></ul><h3 id="常量值的优化" tabindex="-1"><a class="header-anchor" href="#常量值的优化"><span>常量值的优化</span></a></h3><p>在运行 <code>opt_expr</code> 后，您可能会注意到高亮的 <code>$eq</code> 单元的输入 <code>255</code> 已更改为 <code>8&#39;11111111</code>。常量值以 <code>&lt;bit_width&gt;&#39;&lt;bits&gt;</code> 的格式呈现，其中 <code>bit_width</code> 表示位宽，<code>bits</code> 表示二进制值。对于 32 位值，通常使用十进制数表示。这里的 <code>8&#39;11111111</code> 表示一个 8 位宽的二进制值，其十进制等效值为 255。</p><h3 id="位宽减少的原因" tabindex="-1"><a class="header-anchor" href="#位宽减少的原因"><span>位宽减少的原因</span></a></h3><p>这种变化是 <code>opt_expr</code> 执行<strong>常量折叠</strong>和<strong>简单表达式重写</strong>的副作用。具体来说：</p><ol><li><strong>常量折叠</strong>：<code>opt_expr</code> 会计算常量表达式，并将其替换为计算结果。例如，<code>255</code> 是一个常量，因此它被直接替换为其二进制表示 <code>8&#39;11111111</code>。</li><li><strong>位宽优化</strong>：<code>opt_expr</code> 还会分析信号的位宽，并尝试减少不必要的位宽。在这个例子中，<code>255</code> 可以用 8 位表示（因为 (2^8 = 256)），因此 <code>opt_expr</code> 将其从 32 位减少到 8 位。</li></ol><h3 id="为什么位宽减少很重要" tabindex="-1"><a class="header-anchor" href="#为什么位宽减少很重要"><span>为什么位宽减少很重要？</span></a></h3><p>减少位宽可以带来以下好处：</p><ul><li><strong>资源节省</strong>：更小的位宽意味着更少的逻辑单元和布线资源被占用。</li><li><strong>性能提升</strong>：较小的位宽通常意味着更快的操作，因为硬件需要处理的数据量减少了。</li><li><strong>功耗降低</strong>：减少位宽可以减少动态功耗，因为更少的信号需要切换。</li></ul><h3 id="示例" tabindex="-1"><a class="header-anchor" href="#示例"><span>示例</span></a></h3><p>假设我们有以下 Verilog 代码：</p><div class="language-verilog line-numbers-mode" data-highlighter="shiki" data-ext="verilog" data-title="verilog" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">reg</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">31</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">] addr;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">always</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> @(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">posedge</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> clk) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">begin</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (addr == </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">255</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">begin</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // Do something</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    end</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">end</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在运行 <code>opt_expr</code> 后，<code>addr == 255</code> 会被优化为 <code>addr == 8&#39;11111111</code>，因为 <code>255</code> 可以用 8 位表示。</p><h3 id="进一步阅读" tabindex="-1"><a class="header-anchor" href="#进一步阅读"><span>进一步阅读</span></a></h3><p>如果您对 <code>opt_expr</code> 的更多细节感兴趣，可以参考以下部分：</p><ul><li><strong>优化过程</strong>：详细介绍了 Yosys 中的各种优化步骤。</li><li><strong><code>opt_expr</code> 部分</strong>：专门讨论了常量折叠和表达式重写的机制。</li></ul><h3 id="总结" tabindex="-1"><a class="header-anchor" href="#总结"><span>总结</span></a></h3><p>通过运行 <code>opt_expr</code>，Yosys 能够优化设计中的常量值和表达式，减少不必要的位宽并简化逻辑。这不仅提高了设计的效率，还为后续的综合和硬件映射步骤奠定了基础。</p><p><strong>注意</strong>：在设计流程中，理解这些优化步骤的作用非常重要。它们可以帮助您更好地控制设计的资源利用率和性能。</p>`,253))])}const u=n(y,[["render",o],["__file","chapter3.html.vue"]]),C=JSON.parse('{"path":"/book/chapter3.html","title":"第3讲：开源Verilog综合工具","lang":"zh-cn","frontmatter":{"title":"第3讲：开源Verilog综合工具","author":["周贤中"],"date":"2025-03-30T00:00:00.000Z","subject":"Markdown","keywords":["FPGA","系统设计"],"lang":"zh-cn"},"headers":[{"level":2,"title":"开源硬件综合工具介绍","slug":"开源硬件综合工具介绍","link":"#开源硬件综合工具介绍","children":[{"level":3,"title":"Yosys：Verilog逻辑综合引擎","slug":"yosys-verilog逻辑综合引擎","link":"#yosys-verilog逻辑综合引擎","children":[]},{"level":3,"title":"OpenROAD：物理综合工具链","slug":"openroad-物理综合工具链","link":"#openroad-物理综合工具链","children":[]},{"level":3,"title":"工具链对比矩阵","slug":"工具链对比矩阵","link":"#工具链对比矩阵","children":[]},{"level":3,"title":"开发环境配置建议","slug":"开发环境配置建议","link":"#开发环境配置建议","children":[]},{"level":3,"title":"扩展资源","slug":"扩展资源","link":"#扩展资源","children":[]}]},{"level":2,"title":"Yosys使用教程","slug":"yosys使用教程","link":"#yosys使用教程","children":[{"level":3,"title":"Yosys 简介","slug":"yosys-简介","link":"#yosys-简介","children":[]},{"level":3,"title":"你可以用 Yosys 做什么","slug":"你可以用-yosys-做什么","link":"#你可以用-yosys-做什么","children":[]},{"level":3,"title":"Yosys 的典型应用","slug":"yosys-的典型应用","link":"#yosys-的典型应用","children":[]},{"level":3,"title":"Yosys 不能做什么","slug":"yosys-不能做什么","link":"#yosys-不能做什么","children":[]},{"level":3,"title":"Yosys安装","slug":"yosys安装","link":"#yosys安装","children":[]},{"level":3,"title":"综合入门","slug":"综合入门","link":"#综合入门","children":[]},{"level":3,"title":"示例设计","slug":"示例设计","link":"#示例设计","children":[]},{"level":3,"title":"1. 模块 addr_gen（地址生成器/计数器）","slug":"_1-模块-addr-gen-地址生成器-计数器","link":"#_1-模块-addr-gen-地址生成器-计数器","children":[]},{"level":3,"title":"2. 模块 fifo（同步 FIFO）","slug":"_2-模块-fifo-同步-fifo","link":"#_2-模块-fifo-同步-fifo","children":[]},{"level":3,"title":"整体设计总结","slug":"整体设计总结","link":"#整体设计总结","children":[]},{"level":3,"title":"1. 测试平台结构","slug":"_1-测试平台结构","link":"#_1-测试平台结构","children":[]},{"level":3,"title":"2. 时钟生成","slug":"_2-时钟生成","link":"#_2-时钟生成","children":[]},{"level":3,"title":"3. 主测试流程","slug":"_3-主测试流程","link":"#_3-主测试流程","children":[]},{"level":3,"title":"4. 测试用例详解","slug":"_4-测试用例详解","link":"#_4-测试用例详解","children":[]},{"level":3,"title":"5. 波形记录与仿真结束","slug":"_5-波形记录与仿真结束","link":"#_5-波形记录与仿真结束","children":[]},{"level":3,"title":"加载设计","slug":"加载设计","link":"#加载设计","children":[]},{"level":3,"title":"细化","slug":"细化","link":"#细化","children":[]},{"level":3,"title":"addr_gen 模块","slug":"addr-gen-模块","link":"#addr-gen-模块","children":[]},{"level":3,"title":"测试流程","slug":"测试流程","link":"#测试流程","children":[]},{"level":3,"title":"模块结构","slug":"模块结构","link":"#模块结构","children":[]},{"level":3,"title":"关键设计要点","slug":"关键设计要点","link":"#关键设计要点","children":[]},{"level":3,"title":"潜在改进点","slug":"潜在改进点","link":"#潜在改进点","children":[]},{"level":3,"title":"简单操作的处理","slug":"简单操作的处理","link":"#简单操作的处理","children":[]},{"level":3,"title":"运行 proc -noopt","slug":"运行-proc-noopt","link":"#运行-proc-noopt","children":[]},{"level":3,"title":"示例输出","slug":"示例输出","link":"#示例输出","children":[]},{"level":3,"title":"原理图变化","slug":"原理图变化","link":"#原理图变化","children":[]},{"level":3,"title":"处理 proc -noopt 后的设计","slug":"处理-proc-noopt-后的设计","link":"#处理-proc-noopt-后的设计","children":[]},{"level":3,"title":"浮空线的处理","slug":"浮空线的处理","link":"#浮空线的处理","children":[]},{"level":3,"title":"清理和优化","slug":"清理和优化","link":"#清理和优化","children":[]},{"level":3,"title":"原理图变化","slug":"原理图变化-1","link":"#原理图变化-1","children":[]},{"level":3,"title":"常量值的优化","slug":"常量值的优化","link":"#常量值的优化","children":[]},{"level":3,"title":"位宽减少的原因","slug":"位宽减少的原因","link":"#位宽减少的原因","children":[]},{"level":3,"title":"为什么位宽减少很重要？","slug":"为什么位宽减少很重要","link":"#为什么位宽减少很重要","children":[]},{"level":3,"title":"示例","slug":"示例","link":"#示例","children":[]},{"level":3,"title":"进一步阅读","slug":"进一步阅读","link":"#进一步阅读","children":[]},{"level":3,"title":"总结","slug":"总结","link":"#总结","children":[]}]}],"git":{"createdTime":1738908357000,"updatedTime":1749345260000,"contributors":[{"name":"Xianzhong Zhou","username":"Xianzhong Zhou","email":"zhouxzh@gdut.edu.cn","commits":5,"url":"https://github.com/Xianzhong Zhou"}]},"readingTime":{"minutes":32.38,"words":9713},"filePathRelative":"book/chapter3.md","localizedDate":"2025年3月30日"}');export{u as comp,C as data};
